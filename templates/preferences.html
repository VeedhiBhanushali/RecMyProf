<!DOCTYPE html>
<html>
<head>
    <title>Professor Preferences</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="/" class="nav-logo">
                    <span class="material-icons">school</span>
                    Rec My Prof
                </a>
            </div>
            <div class="nav-right">
                <a href="/pref" class="nav-item active">Personalize</a>
                <a href="/dash" class="nav-item">Analytics</a>
                <a href="/" class="nav-item">Chat</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Find Your Ideal SJSU Professor</h1>
            <p class="subtitle">Discover professors that match your learning style and academic goals at San José State University</p>
        </div>

        <form id="preferences-form" method="POST">
            <div class="preferences-grid">
                <div class="preferences-section">
                    <div class="form-group">
                        <h3>Learning Environment</h3>
                        <p class="section-desc">Select your preferred classroom experience</p>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="attendance" name="preferences[]" value="attendance_mandatory">
                                <label for="attendance">Mandatory Attendance</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="assignment_heavy" name="preferences[]" value="assignment_heavy">
                                <label for="assignment_heavy">Assignment Heavy</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="test_heavy" name="preferences[]" value="test_heavy">
                                <label for="test_heavy">Test Heavy</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="participation" name="preferences[]" value="participation_heavy">
                                <label for="participation">Participation Heavy</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pop_quiz" name="preferences[]" value="pop_quiz">
                                <label for="pop_quiz">Pop Quizzes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="group_work" name="preferences[]" value="group_work">
                                <label for="group_work">Group Work</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="flexible_deadlines" name="preferences[]" value="flexible_deadlines">
                                <label for="flexible_deadlines">Flexible Deadlines</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="structured" name="preferences[]" value="structured">
                                <label for="structured">Well Structured</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <h3>Teaching Approach</h3>
                        <p class="section-desc">Choose how you prefer your professors to teach</p>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="great_lecturer" name="preferences[]" value="great_lecturer">
                                <label for="great_lecturer">Great Lecturer</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="clear_grading" name="preferences[]" value="clear_grading">
                                <label for="clear_grading">Clear Grading Criteria</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="extra_credit" name="preferences[]" value="extra_credit">
                                <label for="extra_credit">Extra Credit Opportunities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="self_study" name="preferences[]" value="self_study">
                                <label for="self_study">Self-Study Friendly</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hands_on" name="preferences[]" value="hands_on">
                                <label for="hands_on">Hands-on Learning</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="real_world" name="preferences[]" value="real_world">
                                <label for="real_world">Real-world Examples</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="slides" name="preferences[]" value="slides">
                                <label for="slides">Provides Slides/Notes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="engaging" name="preferences[]" value="engaging">
                                <label for="engaging">Engaging Teaching</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <h3>Student Support</h3>
                        <p class="section-desc">Tell us about your specific needs</p>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="international" name="context[]" value="international">
                                <label for="international">International Student Support</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="working_student" name="context[]" value="working">
                                <label for="working_student">Working Student Friendly</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="first_gen" name="context[]" value="first_gen">
                                <label for="first_gen">First Generation Student Support</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="esl" name="context[]" value="esl">
                                <label for="esl">ESL-Friendly Teaching</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <h3>Schedule Preferences</h3>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="early_morning" name="timing[]" value="early">
                                <label for="early_morning">Early Morning Classes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="evening" name="timing[]" value="evening">
                                <label for="evening">Evening Classes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hybrid" name="timing[]" value="hybrid">
                                <label for="hybrid">Hybrid/Online Options</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="flexible_attendance" name="timing[]" value="flexible">
                                <label for="flexible_attendance">Flexible Attendance Policy</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="preferences-section filters">
                    <div class="filters-header">
                        <h3>Set Your Standards</h3>
                        <p class="section-desc">Adjust these filters to find your best match</p>
                    </div>
                    <div class="form-group">
                        <label for="department">Department:</label>
                        <select id="department" name="department">
                            <option value="">Any</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Computer Engineering">Computer Engineering</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="min_rating">Minimum Rating:</label>
                        <input type="number" id="min_rating" name="min_rating" min="1" max="5" step="0.1" value="3.0">
                    </div>

                    <div class="form-group">
                        <label for="max_difficulty">Maximum Difficulty:</label>
                        <input type="number" id="max_difficulty" name="max_difficulty" min="1" max="5" step="0.1" value="4.0">
                    </div>

                    <div class="form-group">
                        <label for="would_take_again">Minimum "Would Take Again" %:</label>
                        <input type="number" id="would_take_again" name="would_take_again" min="0" max="100" value="70">
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-button">
                <span class="material-icons">search</span>
                Find Matching Professors
            </button>
        </form>

        <div id="results" class="results-container animate-fade-in"></div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>© 2024 Rec My Prof - Your AI-powered professor recommendation assistant</p>
        </div>
    </footer>

    <!-- Chat Widget -->
    <div id="chat-widget" class="chat-widget">
        <div class="chat-header" onclick="toggleChat()">
            <span class="material-icons">support_agent</span>
            <span>AI Assistant</span>
            <span class="material-icons toggle-icon">expand_less</span>
            <a href="/chat.html" class="chat-expand" onclick="event.stopPropagation()">
                <span class="material-icons">open_in_new</span>
            </a>
        </div>
        <div class="chat-content">
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Ask about professors or courses...">
                <button onclick="sendMessage()">
                    <span class="material-icons">send</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('preferences-form').onsubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('.submit-button');
            const resultsDiv = document.getElementById('results');
            
            // Show loading state
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = `
                <span class="material-icons pulse">hourglass_empty</span>
                Finding Matches...
            `;
            
            try {
                const response = await fetch('/pref', {
                    method: 'POST',
                    body: new FormData(form)
                });
                const data = await response.json();
                if (data.error) {
                    alert(data.error);
                    return;
                }
                displayResults(data.professors);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while processing your request.');
            } finally {
                // Reset button state
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = `
                    <span class="material-icons">search</span>
                    Find Matching Professors
                `;
            }
        };

        function displayResults(professors) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            if (!professors || professors.length === 0) {
                resultsDiv.innerHTML = '<p>No professors found.</p>';
                return;
            }
            
            // Add results header
            const headerDiv = document.createElement('div');
            headerDiv.className = 'results-header';
            headerDiv.innerHTML = `
                <h3>Top ${professors.length} Matching Professors</h3>
                <p class="results-note">Showing professors sorted by match score</p>
            `;
            resultsDiv.appendChild(headerDiv);
            
            professors.forEach(prof => {
                const profDiv = document.createElement('div');
                profDiv.className = 'professor-card';
                
                // Get relevant tags and reviews
                const relevantTags = prof.tags ? prof.tags.join(', ') : '';
                const matchScore = prof.match_score ? prof.match_score.toFixed(1) : 0;
                
                // Add match score color based on score
                const scoreColor = matchScore >= 80 ? '#4caf50' : 
                                 matchScore >= 60 ? '#ff9800' : 
                                 '#f44336';
                
                profDiv.innerHTML = `
                    <h3>${prof.first_name} ${prof.last_name}</h3>
                    <div class="match-score" style="background-color: ${scoreColor}20;">
                        <span class="score-label">Match Score:</span>
                        <span class="score-value" style="color: ${scoreColor}">${matchScore}%</span>
                        <div class="score-tooltip">
                            <p>Base Match: ${(prof.base_score || 0).toFixed(1)}%</p>
                            <p>Context Match: ${(prof.context_score || 0).toFixed(1)}%</p>
                            <p>Success Prediction: ${(prof.success_prediction || 0).toFixed(1)}%</p>
                        </div>
                    </div>
                    <div class="prof-stats">
                        <div class="stat-item" title="Overall Rating">
                            <span class="material-icons">grade</span>
                            <span>${prof.overall_rating}/5.0</span>
                        </div>
                        <div class="stat-item" title="Course Difficulty">
                            <span class="material-icons">psychology</span>
                            <span>${prof.difficulty}/5.0</span>
                        </div>
                        <div class="stat-item" title="Would Take Again">
                            <span class="material-icons">thumb_up</span>
                            <span>${prof.would_take_again}%</span>
                        </div>
                        <div class="stat-item" title="Department">
                            <span class="material-icons">school</span>
                            <span>${prof.department}</span>
                        </div>
                    </div>
                    <div class="tags-section">
                        <h4>Teaching Style</h4>
                        <div class="tags-container">
                            ${relevantTags.split(',').map(tag => 
                                `<span class="tag">${tag.trim()}</span>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="recent-review">
                        <div class="review-header">
                            <span class="material-icons">format_quote</span>
                            <h4>Recent Review</h4>
                        </div>
                        <p>${prof.recent_review || 'No recent reviews'}</p>
                    </div>
                    <button class="view-details-btn">
                        <span class="material-icons">visibility</span>
                        View Full Profile
                    </button>
                `;
                resultsDiv.appendChild(profDiv);
            });
        }

        // Chat Widget Functions
        let chatOpen = false;
        
        function toggleChat() {
            const widget = document.getElementById('chat-widget');
            const toggleIcon = document.querySelector('.toggle-icon');
            chatOpen = !chatOpen;
            widget.classList.toggle('open');
            toggleIcon.textContent = chatOpen ? 'expand_more' : 'expand_less';
        }
        
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            const messagesDiv = document.getElementById('chat-messages');
            messagesDiv.innerHTML += `
                <div class="user-message">
                    <span class="message-text">${message}</span>
                </div>
            `;
            
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message,
                        session_id: localStorage.getItem('chat_session_id') || 'new'
                    })
                });
                
                const data = await response.json();
                
                // Store session ID if new
                if (data.session_id) {
                    localStorage.setItem('chat_session_id', data.session_id);
                }
                
                messagesDiv.innerHTML += `
                    <div class="bot-message">
                        <span class="message-text">${data.response}</span>
                    </div>
                `;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } catch (error) {
                console.error('Error:', error);
                messagesDiv.innerHTML += `
                    <div class="bot-message error">
                        <span class="message-text">Sorry, I encountered an error. Please try again or visit the AI Assistant page for full functionality.</span>
                    </div>
                `;
            }
        }
        
        // Enter key to send message
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html> 